/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package home.tests.ipaddrcounter;

import java.io.BufferedInputStream;
import java.io.File;
import java.io.InputStream;
import java.io.IOException;
import java.util.BitSet;
import java.util.zip.ZipFile;

public class App {

    // leaf of IPs trees means all children are set
    private static final Object ALL_NODES = new Object();

    // Tree of IPs
    // null - no children are set
    // ALL_NODES - all childre are set
    // BitSet(256) - otherwise
    private static Object TREE = null;
    
    public static void readIPs(InputStream is) throws IOException {
        try (var bis = new BufferedInputStream(is)) {
            int currentByte = 0;
            byte[] bytes = new byte[4];

            int ch;
            while ((ch = bis.read()) != -1) {
                if (ch == (int)'.') {
                    currentByte++;
                } else if (ch == (int)'\n') {
                    // ToDo: process IP
                    System.out.println("Line: " + (bytes[0] & 0xff) + "." + (bytes[1] & 0xff) + "." + (bytes[2] & 0xff) + "."+ (bytes[3] & 0xff));
                    currentByte = 0;
                    bytes[0] = bytes[1] = bytes[2] = bytes[3] = 0;
                } else if (ch >= (int)'0' && ch <= (int)'9') {
                    bytes[currentByte] = (byte)(bytes[currentByte] * 10 + (ch - (int)'0'));
                }
            }
        }
    }
    
    public static void main(String[] args) throws IOException {
        try (var zip = new ZipFile(new File(args[0]), ZipFile.OPEN_READ)) {
            var entries = zip.entries();
            if (entries.hasMoreElements()) {
                var entry = entries.nextElement();
                try (var is = zip.getInputStream(entry)) {
                    readIPs(is);
                }
            }
        }
    }
}
